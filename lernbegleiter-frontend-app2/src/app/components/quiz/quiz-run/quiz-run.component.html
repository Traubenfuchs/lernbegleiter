<div class="container">

  <div class="card" *ngIf="loginService.loggedInAndStudent()">

    <div class="card-body">
      <div>Zeit übrig: {{timeLeft}}</div>
      <ng-container *ngIf="_QuizRunState.WAITING_FOR_ANSWERS == _QuizRunState[quizRun.state]">
        <div *ngFor="let question of quizRun.currentQuestions">
          <div>{{question.content}}</div>
          <img *ngIf="question.lob.quizPictureUUID" [src]="'/api/image/' + question.lob.quizPictureUUID">
          <div *ngFor="let answer of question.answers">
            <div>{{answer.content}}</div>
            <button (click)="flipAnswerTo(answer.uuid, false)" class="btn btn-secondary"
              *ngIf='answer.correct'>✔️</button>
            <button (click)="flipAnswerTo(answer.uuid, true)" class="btn btn-secondary"
              *ngIf='!answer.correct'>❌</button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="_QuizRunState.WAITING_FOR_NEXT_QUESTION == _QuizRunState[quizRun.state]">
        <div>Bitte warte bis die nächste Frage freigeschalten wurde...</div>
      </ng-container>

      <ng-container *ngIf="_QuizRunState.CREATED == _QuizRunState[quizRun.state]">
        <div>Bitte warte bis das Quiz gestartet wurde...</div>
      </ng-container>

      <ng-container *ngIf="_QuizRunState.DONE == _QuizRunState[quizRun.state]">
        <div>Dieser Quizlauf ist vorbei.</div>
      </ng-container>
    </div>
  </div>

  <ng-container *ngIf="loginService.loggedInAndTeacherOrAdmin()">
    <div class="card" *ngIf="loginService.loggedInAndTeacherOrAdmin()">
      <div class="card-header" *ngIf="uuid === 'new'">
        <h5 class="card-title">Quizlauf anlegen</h5>
        <p class="card-text">Hier kannst du einen neuen Quizlauf anlegen</p>
      </div>
      <div class="card-header" *ngIf="uuid !== 'new'">
        <h5 class="card-title">Quizlauf bearbeiten</h5>
        <p class="card-text">Hier kannst du einen Quizlauf bearbeiten</p>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col">
            <label for="uuidInput">UUID</label>
            <input id="uuidInput" [(ngModel)]="quizRun.uuid" type="text" class="form-control" placeholder="UUID"
              disabled>
          </div>
          <div class="col">
            <label for="stateInput">Status</label>
            <input id="stateInput" [(ngModel)]="quizRun.state" type="text" class="form-control" placeholder="Status"
              disabled>
          </div>
        </div> <!-- ends row-->
        <div class="row">
          <div class="col">
            <label for="typeInput">Quiz-Typ</label>
            <select id="typeInput" [(ngModel)]="quizRun.quizRunType" class="form-control" [disabled]='uuid !== "new" ? true : null'>
              <option value="ONE_QUESTION_AT_A_TIME">Einzelne Frage mit Timelimit</option>
              <option value="FREE_ANSWERING">freies Antworten / take home</option>
            </select>
          </div>
          <div class="col">
            <ng-container *ngIf="quizRun.quizRunType === 'FREE_ANSWERING'">
              <label for="nextTimeLimitInput">Quiz endet am & um</label>
              <input id="nextTimeLimitInput" [(ngModel)]="quizRun.nextTimeLimit" type="datetime-local"
                class="form-control" [attr.disabled]='uuid !== "new" ? true : null'>
            </ng-container>
          </div>
        </div><!-- ends row-->
        <div class="row mt-3"
          *ngIf="_QuizRunState.CREATED ==_QuizRunState[quizRun.state] || _QuizRunState.WAITING_FOR_NEXT_QUESTION == _QuizRunState[quizRun.state]">
          <div class="col">
            <button (click)='advance()' class="btn btn-success"
              *ngIf="_QuizRunState.WAITING_FOR_NEXT_QUESTION == _QuizRunState[quizRun.state]">Nächste
              Frage aktivieren</button>
            <button (click)='advance()' class="btn btn-success"
              *ngIf="_QuizRunState.CREATED == _QuizRunState[quizRun.state]">Quiz starten</button>
          </div>
        </div><!-- ends row-->
        <div class="row mt-3">
          <div class="col">
            <div>Zeit übrig: {{timeLeft}}</div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <!--<div *ngIf="uuid !== 'new'" class="btn-group w-100">
            <button (click)="saveClick()" class="btn btn-secondary">Aktualisieren</button>
        </div> -->
        <button (click)="saveClick()" *ngIf="uuid === 'new'" class="btn btn-success w-100">Anlegen</button>
      </div>
    </div>

    <div class="card" class="card mt-3" *ngIf="uuid !== 'new' && loginService.loggedInAndTeacherOrAdmin()">
      <div class="card-header">
        <h5 class="card-title">Quizergebnisse</h5>
        <p class="card-text">Hier kannst du die Quizergebnisse sehen</p>
      </div>
      <div class="card-body">
        <div *ngFor="let line of quizResult.entries">
          <div>{{line.name}}</div>
          <div>{{line.points}}</div>
        </div>
      </div>
    </div>

  </ng-container>
</div>
